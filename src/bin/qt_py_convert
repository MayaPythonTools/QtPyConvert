#!/tools/bin/python2.7
import os
import sys

if sys.version_info[0] == 2 and sys.version_info[1] < 7:
    import dd.runtime.api
    dd.runtime.api.load("argparse")
import argparse

from qt_py_convert.run import process_file, process_folder


def parse():
    parser = argparse.ArgumentParser(
        "qt_py_convert"
    )

    parser.add_argument(
        "files_or_directories",
        nargs="+",
        help="Pass explicit files or a directories to run."
    )
    parser.add_argument(
        "-r", "--recursive",
        action="store_true",
        help="Recursively search for python files to convert. "
             "Only applicable when passing a directory.",
    )
    parser.add_argument(
        "-w", "--write",
        action="store_true",
        help="Overwrite the file in place.",
    )
    parser.add_argument(
        "--no-lines",
        action="store_true",
        help="Turn off printing the line numbers that things are replaced at. "
             "Ends up being much faster.",
    )
    return parser.parse_args()


def main(pathlist, recursive=True, write=False, no_lines=False):
    # process_paths = []
    # for path in pathlist:
    #     if path == "*":
    #         process_paths.append(
    #             [
    #                 os.path.join(os.getcwd(), local_path)
    #                 for local_path in os.listdir(os.getcwd())
    #             ]
    #         )
    #     else:
    #         process_paths.append(path)

    for path in [os.path.abspath(p) for p in pathlist]:
        # print("Processing %s" % path)
        if os.path.isdir(path):
            process_folder(
                path,
                recursive=recursive,
                write=write,
                skip_lineno=no_lines
            )
        else:
            process_file(
                path,
                write=write,
                skip_lineno=no_lines
            )


if __name__ == "__main__":
    args = parse()
    main(args.files_or_directories, args.recursive, args.write, args.no_lines)
