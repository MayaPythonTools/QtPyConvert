#!/tools/bin/python2.7
import os
import sys

if sys.version_info[0] == 2 and sys.version_info[1] < 7:
    import dd.runtime.api
    dd.runtime.api.load("argparse")
import argparse

from qt_py_convert.run import process_file, process_folder


def parse():
    parser = argparse.ArgumentParser(
        "qt_py_convert"
    )

    parser.add_argument(
        "file_or_directory",
        help="Pass an explicit file or a directory to run"
    )
    parser.add_argument(
        "-r", "--recursive",
        action="store_true",
        help="Recursively search for python files to convert. "
             "Only applicable when passing a directory",
    )
    parser.add_argument(
        "-w", "--write",
        action="store_true",
        help="Overwrite the file in place",
    )
    return parser.parse_args()


def main(path, recursive=True, write=False):
    print("Processing %s" % path)
    if os.path.isdir(path):
        print()
        process_folder(path, recursive=recursive, write=write)
    else:
        process_file(path, write=write)


if __name__ == "__main__":
    args = parse()
    main(args.file_or_directory, args.recursive, args.write)
